<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>True Dynamic Shirt & Pant Color Matcher</title>

<style>
body{
  margin:16px;
  background:#fafafa;
  font-family:system-ui,-apple-system,sans-serif;
}
h2{margin-bottom:10px}
label{display:block;margin:10px 0}
select,input{
  padding:6px 10px;
  border-radius:6px;
  border:1px solid #ccc
}
.section{margin-top:20px}
.section h3{margin:6px 0;font-size:14px}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(120px,1fr));
  gap:10px
}
.box{
  height:55px;
  border-radius:6px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:12px;
  font-weight:600;
}
canvas{
  display:block;
  width:100%;
  min-height:220px;
  border:1px solid #ccc;
  border-radius:8px;
  margin-top:10px;
}
.color-preview{
  width:70px;
  height:40px;
  border-radius:6px;
  border:1px solid #ccc;
}
</style>
</head>

<body>

<h2>Men’s True Dynamic Color Matcher</h2>

<label>
  Base Color:
  <input type="color" id="baseColor" value="#1F3A5F">
</label>

<label>
  Occasion:
  <select id="occasion">
    <option value="formal">Formal</option>
    <option value="casual">Casual</option>
    <option value="tshirt">Daily</option>
    <option value="party">Party</option>
    <option value="traditional">Traditional</option>
  </select>
</label>

<input type="file" id="upload" accept="image/*">
<canvas id="canvas"></canvas>

<div style="display:flex;gap:10px;margin-top:8px">
  <div class="color-preview" id="preview"></div>
  <div id="pickedHex">HEX: —</div>
</div>

<div id="result"></div>

<script>
/* ---------- COLOR MATH ---------- */
function hexToRgb(hex){
  return hex.replace("#","").match(/.{2}/g).map(v=>parseInt(v,16));
}
function rgbToHex(r,g,b){
  return "#"+[r,g,b].map(v=>v.toString(16).padStart(2,"0")).join("").toUpperCase();
}
function rgbToHsl(r,g,b){
  r/=255; g/=255; b/=255;
  const max=Math.max(r,g,b), min=Math.min(r,g,b);
  let h,s,l=(max+min)/2;
  if(max===min){h=s=0;}
  else{
    const d=max-min;
    s=l>0.5?d/(2-max-min):d/(max+min);
    switch(max){
      case r:h=(g-b)/d+(g<b?6:0);break;
      case g:h=(b-r)/d+2;break;
      case b:h=(r-g)/d+4;break;
    }
    h*=60;
  }
  return [h,s,l];
}
function hslToHex(h,s,l){
  s=Math.max(0,Math.min(1,s));
  l=Math.max(0,Math.min(1,l));
  const c=(1-Math.abs(2*l-1))*s;
  const x=c*(1-Math.abs((h/60)%2-1));
  const m=l-c/2;
  let r=0,g=0,b=0;
  if(h<60){r=c;g=x}
  else if(h<120){r=x;g=c}
  else if(h<180){g=c;b=x}
  else if(h<240){g=x;b=c}
  else if(h<300){r=x;b=c}
  else{r=c;b=x}
  return rgbToHex(
    Math.round((r+m)*255),
    Math.round((g+m)*255),
    Math.round((b+m)*255)
  );
}
function textColor(hex){
  const [r,g,b]=hexToRgb(hex);
  return (0.2126*r+0.7152*g+0.0722*b)/255>0.6?"#000":"#FFF";
}
function box(hex){
  return `<div class="box" style="background:${hex};color:${textColor(hex)}">${hex}</div>`;
}

/* ---------- TRUE DYNAMIC GENERATOR ---------- */
function generateOutfits(baseHex, occasion){
  const [r,g,b]=hexToRgb(baseHex);
  let [h,s,l]=rgbToHsl(r,g,b);

  if(occasion==="formal") s*=0.45;
  if(occasion==="party") s=Math.min(1,s*1.3);

  const shirtLight = l < 0.5 ? 0.75 : 0.55;
  const pantLight  = l < 0.5 ? 0.35 : 0.25;

  return {
    shirt:[
      hslToHex(0,0,0.95),                           // neutral white
      hslToHex((h+30)%360, s*0.6, shirtLight),      // analogous
      hslToHex((h+180)%360, s*0.65, shirtLight),    // complementary
      hslToHex((h+150)%360, s*0.6, shirtLight),     // split comp
      hslToHex((h+120)%360, s*0.6, shirtLight)      // triadic
    ],
    pant:[
      hslToHex(0,0,0.15),                           // neutral black
      hslToHex((h+210)%360, s*0.55, pantLight),     // split comp
      hslToHex((h+180)%360, s*0.5, pantLight),      // complementary
      hslToHex((h+330)%360, s*0.5, pantLight),      // cool shift
      hslToHex((h+120)%360, s*0.45, pantLight)      // triadic
    ],
    shoes:[
      "#000000",
      hslToHex(30,0.4,0.25),
      hslToHex((h+180)%360,0.3,0.22),
      hslToHex(0,0,0.35)
    ]
  };
}

/* ---------- RENDER ---------- */
function render(){
  const base=baseColor.value;
  const o=generateOutfits(base, occasion.value);
  result.innerHTML=`
    <div class="section">
      <h3>Base Color</h3>
      <div class="grid">${box(base)}</div>
    </div>
    <div class="section">
      <h3>Shirt Options</h3>
      <div class="grid">${o.shirt.map(box).join("")}</div>
    </div>
    <div class="section">
      <h3>Pant Options</h3>
      <div class="grid">${o.pant.map(box).join("")}</div>
    </div>
    <div class="section">
      <h3>Shoes</h3>
      <div class="grid">${o.shoes.map(box).join("")}</div>
    </div>
  `;
}

/* ---------- IMAGE PICKER ---------- */
const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");

upload.onchange=e=>{
  const img=new Image();
  img.onload=async()=>{
    if(img.decode) await img.decode();
    const scale=Math.min(1,(innerWidth-32)/img.width);
    canvas.width=img.width*scale;
    canvas.height=img.height*scale;
    ctx.drawImage(img,0,0,canvas.width,canvas.height);
  };
  img.src=URL.createObjectURL(e.target.files[0]);
};

function pick(x,y){
  const r=canvas.getBoundingClientRect();
  const d=ctx.getImageData(
    (x-r.left)*(canvas.width/r.width),
    (y-r.top)*(canvas.height/r.height),
    1,1
  ).data;
  const hex=rgbToHex(d[0],d[1],d[2]);
  baseColor.value=hex;
  preview.style.background=hex;
  pickedHex.textContent="HEX: "+hex;
  render();
}
canvas.addEventListener("touchstart",e=>{
  e.preventDefault();
  pick(e.touches[0].clientX,e.touches[0].clientY);
},{passive:false});
canvas.addEventListener("mousedown",e=>pick(e.clientX,e.clientY));

baseColor.oninput=render;
occasion.onchange=render;
render();
</script>

</body>
</html>
